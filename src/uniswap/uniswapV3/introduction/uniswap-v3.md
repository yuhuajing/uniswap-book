
# Uniswap V3ç®€ä»‹

> æœ¬ç« èŠ‚ä¸»è¦è®²è¿°äº† [Uniswap V3ç™½çš®ä¹¦](https://uniswap.org/whitepaper-v3.pdf)ä¸­çš„å†…å®¹ã€‚åŒæ ·ï¼Œå‡è®¾ä½ æ²¡æœ‰ç†è§£æœ¬ç« çš„æ‰€æœ‰æ¦‚å¿µä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬åœ¨åé¢ç« èŠ‚ç›´æ¥çœ‹ä»£ç å¯èƒ½ä¼šæ›´æ¸…æ™°ã€‚

ä¸ºäº†æ›´å¥½åœ°ç†è§£ `UniswapV3` çš„åˆ›æ–°ä¹‹å¤„åœ¨å“ªé‡Œï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ `UniswapV2` çš„ç¼ºç‚¹æœ‰å“ªäº›ã€‚

`UniswapV2` ä½¿ç”¨ `AMM` æœºåˆ¶å®ç°äº†ä¸€ä¸ªé€šç”¨çš„äº¤æ˜“å¸‚åœºã€‚ Â·ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„äº¤æ˜“å¯¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œäº¤æ˜“å¯¹å¯ä»¥æ ¹æ®ä»·æ ¼çš„æ³¢åŠ¨æ€§åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š

1. ä»·æ ¼æ³¢åŠ¨æ€§ä¸­ç­‰æˆ–è¾ƒé«˜çš„ä»£å¸å¯¹ã€‚å¤§å¤šæ•°ä»£å¸å¯¹éƒ½å±äºè¿™ä¸€ç±»ï¼Œå› ä¸ºç»å¤§å¤šæ•°ä»£å¸å¹¶æ²¡æœ‰é”šå®š(`pegged to`)åˆ°æŸäº›ä¸œè¥¿ï¼Œå› æ­¤å…¶ä»·æ ¼éšç€å¸‚åœºæ³¢åŠ¨è€Œæ³¢åŠ¨ã€‚
2. ä»·æ ¼æ³¢åŠ¨æ€§ä½çš„ä»£å¸å¯¹ã€‚è¿™ä¸€ç±»åŒ…å«äº†æœ‰é”šå®šçš„ä»£å¸ï¼Œä¸»è¦ä¸ºç¨³å®šå¸`ï¼šUSDT/USDC`ï¼Œ`USDC/DAI`ï¼Œ`USDT/DAI` ç­‰ç­‰ã€‚ä¹ŸåŒ…æ‹¬ `ETH/stETH`ï¼Œ`ETH/rETH`ï¼ˆä¸€äº› `wrapped ETH`ï¼‰ç­‰ç±»å‹ã€‚

è¿™äº›ä¸åŒçš„ä»£å¸å¯¹ï¼Œå¯¹äºæµåŠ¨æ€§æ± çš„é…ç½®æœ‰ä¸åŒçš„è¦æ±‚ã€‚æœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºï¼Œé”šå®šä»£å¸å¯¹éœ€è¦éå¸¸é«˜çš„æµåŠ¨æ€§æ¥é™ä½å¤§é¢äº¤æ˜“å¯¹å…¶ä»·æ ¼çš„å½±å“ã€‚ä½†æ˜¯ `USDC,USDT` çš„ä»·æ ¼å¿…é¡»ä¿æŒåœ¨1é™„è¿‘ï¼Œæ— è®ºæˆ‘è¦ä¹°å–å¤šå¤§æ•°ç›®çš„ä»£å¸ã€‚ç”±äº `UniswapV2` çš„é€šç”¨ `AMM` ç®—æ³•å¯¹äºç¨³å®šå¸äº¤æ˜“å¹¶æ²¡æœ‰å¾ˆå¥½çš„é€‚é…ï¼Œæ‰€ä»¥åœ¨ç¨³å®šå¸çš„äº¤æ˜“ä¸­å…¶ä»–çš„ `AMM`ï¼ˆä¸»è¦æ˜¯[Curve](https://curve.fi)ï¼‰æ›´åŠ æµè¡Œã€‚

å¯¼è‡´è¿™ä¸ªé—®é¢˜å‡ºç°çš„åŸå› æ˜¯ï¼Œ`UniswapV2` æ± å­çš„æµåŠ¨æ€§æ˜¯åˆ†å¸ƒåœ¨æ— ç©·åŒºåŸŸä¸Šçš„â€”â€”æ± å­å…è®¸åœ¨ä»»ä½•ä»·æ ¼çš„äº¤æ˜“å‘ç”Ÿï¼Œä» `0` åˆ°æ­£æ— ç©· ${+ \infty}$ï¼š

![The curve is infinite](../images/milestone_0/curve_infinite.png)

è¿™å¬èµ·æ¥å¥½åƒä¸æ˜¯ä¸€ä¸ªåäº‹ï¼Œä½†äº‹å®ä¸Šå®ƒå¯¼è‡´äº†èµ„äº§åˆ©ç”¨æ•ˆç‡çš„ä¸è¶³ã€‚ä¸€ä¸ªèµ„äº§çš„å†å²ä»·æ ¼é€šå¸¸æ˜¯åœ¨æŸä¸ªåŒºé—´å†…çš„ï¼Œä¸ç®¡è¿™ä¸ªåŒºé—´æ˜¯å¤§è¿˜æ˜¯å°ã€‚
æ¯”å¦‚ï¼Œ`ETH` çš„å†å²ä»·æ ¼å¤§è‡´åœ¨ `1990 ~2100` è¿™ä¸ªåŒºé—´ï¼ˆæ•°æ®æ¥æº [CoinMarketCap](https://coinmarketcap.com/currencies/ethereum/)ï¼‰ã€‚
åœ¨ä»Šå¤©ï¼ˆ2025å¹´3æœˆï¼‰ï¼Œ1 ä¸ª ETH çš„ç°è´§ä»·æ ¼æ˜¯ `1991` ï¼Œæ²¡æœ‰äººä¼šæ„¿æ„ç”¨ `5000` è´­ä¹°ä¸€ä¸ª `ETH`ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªä»·æ ¼ä¸Šæä¾›æµåŠ¨æ€§æ˜¯æ¯«æ— ç”¨å¤„çš„ã€‚å› æ­¤ï¼Œåœ¨è¿œç¦»å½“å‰ä»·æ ¼åŒºé—´çš„ã€æ°¸è¿œä¸ä¼šè¾¾åˆ°çš„æŸä¸ªç‚¹ä¸Šæä¾›æµåŠ¨æ€§æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚

## é›†ä¸­æµåŠ¨æ€§
`UniswapV3` å¼•å…¥äº† *é›†ä¸­æµåŠ¨æ€§(`concentrated liquidity`)* çš„æ¦‚å¿µï¼š
`LP` å¯ä»¥é€‰æ‹©ä»–ä»¬å¸Œæœ›åœ¨å“ªä¸ªä»·æ ¼åŒºé—´æä¾›æµåŠ¨æ€§ã€‚
è¿™ä¸ªæœºåˆ¶é€šè¿‡å°†æ›´å¤šçš„æµåŠ¨æ€§æä¾›åœ¨ä¸€ä¸ªç›¸å¯¹ç‹­çª„çš„ä»·æ ¼åŒºé—´ï¼Œæ¥å¤§å¤§æé«˜èµ„äº§åˆ©ç”¨æ•ˆç‡ï¼›
è¿™ä¹Ÿä½¿ `Uniswap` çš„ä½¿ç”¨åœºæ™¯æ›´åŠ å¤šæ ·åŒ–ï¼šå®ƒç°åœ¨å¯ä»¥å¯¹äºä¸åŒä»·æ ¼æ³¢åŠ¨æ€§çš„æ± å­è¿›è¡Œä¸åŒçš„é…ç½®ã€‚
è¿™å°±æ˜¯ `V3` ç›¸å¯¹äº `V2` çš„ä¸»è¦æå‡ç‚¹ã€‚

ç®€å•åœ°æ¥è¯´ï¼Œä¸€ä¸ª `UniswapV3` çš„äº¤æ˜“å¯¹ç”±è®¸å¤šä¸ª `UniswapV2` çš„äº¤æ˜“å¯¹æ„æˆã€‚
`V2` ä¸ `V3` çš„åŒºåˆ«æ˜¯:
- åœ¨ `V3` ä¸­ï¼Œä¸€ä¸ªäº¤æ˜“å¯¹æœ‰è®¸å¤šçš„**ä»·æ ¼åŒºé—´**ï¼Œè€Œæ¯ä¸ªä»·æ ¼åŒºé—´å†…éƒ½æœ‰**ä¸€å®šæ•°é‡çš„èµ„äº§**ã€‚ä»é›¶åˆ°æ­£æ— ç©·çš„æ•´ä¸ªä»·æ ¼åŒºé—´è¢«åˆ’åˆ†æˆäº†è®¸å¤šä¸ªå°çš„ä»·æ ¼åŒºé—´ï¼Œæ¯ä¸€ä¸ªåŒºé—´ä¸­éƒ½æœ‰ä¸€å®šæ•°é‡çš„æµåŠ¨æ€§ã€‚
- è€Œæ›´å…³é”®çš„ç‚¹åœ¨äºï¼Œåœ¨æ¯ä¸ªå°çš„ä»·æ ¼åŒºé—´ä¸­ï¼Œ**å·¥ä½œæœºåˆ¶ä¸ UniswapV2** å®Œå…¨ä¸€æ ·ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ä¸€ä¸ª `UniswapV3` çš„æ± å­å°±æ˜¯è®¸å¤šä¸ª `V2` çš„æ± å­ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å¯¹è¿™ç§æœºåˆ¶è¿›è¡Œå¯è§†åŒ–ã€‚æˆ‘ä»¬å¹¶ä¸æ˜¯é‡æ–°é€‰æ‹©ä¸€ä¸ªæœ‰é™çš„æ›²çº¿ï¼Œè€Œæ˜¯æˆ‘ä»¬æŠŠå®ƒåœ¨ä»·æ ¼ $a$ ä¸ä»·æ ¼ $b$ ä¹‹é—´çš„éƒ¨åˆ†æˆªå–å‡ºæ¥ï¼ŒæŠŠå®ƒä»¬å½“ä½œæ˜¯æ˜¯æ›²çº¿çš„è¾¹ç•Œã€‚æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬æŠŠæ›²çº¿è¿›è¡Œå¹³ç§»ä½¿å¾—è¾¹ç•Œç‚¹è½åœ¨åæ ‡è½´ä¸Šï¼Œäºæ˜¯å¾—åˆ°äº†ä¸‹å›¾ï¼š

![Uniswap V3 price range](../images/milestone_0/curve_finite.png)

> å®ƒçœ‹èµ·æ¥æˆ–è®¸æœ‰ç‚¹å•è°ƒï¼Œ å› æ­¤ UniswapV3 æœ‰è®¸å¤šçš„ä»·æ ¼åŒºé—´â€”â€”è¿™æ ·å®ƒä»¬å°±ä¸ä¼šæ„Ÿåˆ°å­¤å•äº† ğŸ™‚

æ­£å¦‚æˆ‘ä»¬åœ¨å‰ä¸€ç« ä¸­è®²åˆ°çš„é‚£æ ·ï¼Œäº¤æ˜“ `token` ä½¿å¾—ä»·æ ¼åœ¨æ›²çº¿ä¸Šç§»åŠ¨ï¼Œè€Œä»·æ ¼åŒºé—´é™åˆ¶äº†ä»·æ ¼ç‚¹çš„ç§»åŠ¨ã€‚å½“ä»·æ ¼ç§»åŠ¨åˆ°æ›²çº¿çš„ä¸€ç«¯æ—¶ï¼Œæˆ‘ä»¬è¯´è¿™ä¸ªæ± å­è¢«**è€—å°½äº†**ï¼šå…¶ä¸­ä¸€ç§ä»£å¸çš„èµ„äº§å˜æˆäº† `0`ï¼Œæ— æ³•å†è´­ä¹°è¿™ç§ä»£å¸ï¼ˆå½“ç„¶ï¼Œä»…ä»…æŒ‡åœ¨è¿™ä¸ªä»·æ ¼åŒºé—´å†…ï¼‰ã€‚

å‡è®¾èµ·å§‹ä»·æ ¼åœ¨ä¸Šå›¾ä¸­æ›²çº¿çš„ä¸­é—´ä¸€ç‚¹ã€‚ä¸ºäº†åˆ°è¾¾ç‚¹ $a$ï¼Œæˆ‘ä»¬éœ€è¦è´­ä¹°æ± å­é‡Œæ‰€æœ‰çš„ $y$ æ¥ä½¿å¾—æ± å­é‡Œçš„ $x$ æœ€å¤§åŒ–ï¼›ä¸ºäº†åˆ°è¾¾ç‚¹ $b$ï¼Œæˆ‘ä»¬éœ€è¦ä¹°å…‰æ± å­é‡Œçš„ $x$ ä»è€Œä½¿ $y$ æœ€å¤§åŒ–ã€‚åœ¨è¿™ä¸¤ä¸ªç‚¹ï¼Œæ± å­é‡Œéƒ½åªå‰©ä¸€ç§ tokenã€‚

> ä¸€ä¸ªæœ‰è¶£çš„äº‹å®ï¼šæ ¹æ®è¿™ä¸ªåŸç†ï¼Œå¯ä»¥åˆ©ç”¨V3çš„ä»·æ ¼åŒºé—´æ¥æŒ‚é™ä»·å•ã€‚

å¦‚æœå½“å‰ä»·æ ¼åŒºé—´æ± å­è¢«è€—å°½å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä»·æ ¼ç‚¹ä¼šæ»‘åŠ¨åˆ°ä¸‹ä¸€ä¸ªä»·æ ¼åŒºé—´ã€‚å¦‚æœä¸‹ä¸€ä¸ªä»·æ ¼åŒºé—´ä¸å­˜åœ¨ï¼Œè¿™ç¬”äº¤æ˜“å°±ä¼šä»¥éƒ¨åˆ†æˆäº¤è€Œç»“æŸâ€”â€”æˆ‘ä»¬å°†åœ¨æœ¬ä¹¦åé¢çš„éƒ¨åˆ†çœ‹åˆ°å…¶å¦‚ä½•å®ç°ã€‚

ä¸‹é¢ä¸€å›¾å±•ç¤ºäº† [USDC/ETH æ± å­çš„æµåŠ¨æ€§åˆ†å¸ƒ](https://info.uniswap.org/#/pools/0x8ad599c3a0ff1de082011efddc58f1908eb6e6d8):

![Liquidity in the real USDC/ETH pool](../images/milestone_0/usdceth_liquidity.png)

å¯ä»¥çœ‹åˆ°ï¼Œå¤§é‡æµåŠ¨æ€§é›†ä¸­åœ¨ç°ä»·çš„é™„è¿‘ï¼Œè€Œè¾ƒè¿œçš„ä»·æ ¼åŒºé—´ä¸­çš„æµåŠ¨æ€§è¾ƒå°‘â€”â€”
è¿™æ˜¯å› ä¸º `LP` æ›´å¸Œæœ›æé«˜å®ƒä»¬çš„èµ„äº§åˆ©ç”¨æ•ˆç‡ã€‚å½“ç„¶ï¼Œæ•´ä¸ªåŒºé—´ä¹Ÿä¸æ˜¯æ— ç©·çš„ï¼Œåœ¨å›¾ç‰‡å³ä¾§ä¹Ÿæ˜¾ç¤ºäº†å…¶ä¸Šç•Œã€‚


## Uniswap V3 çš„æ•°å­¦åŸç†

åœ¨æ•°å­¦åŸç†ä¸Šï¼Œ`V3` æ˜¯åŸºäº `V2` çš„ï¼šå®ƒä»¬ä½¿ç”¨äº†ç›¸åŒçš„åº•å±‚å…¬å¼ï¼Œä½†å®é™…ä¸Š `V3` ä½¿ç”¨çš„æ˜¯*å¢å¼ºç‰ˆ*ã€‚

ä¸ºäº†å¤„ç†ä»·æ ¼åŒºé—´ä¹‹é—´çš„è½¬æ¢ï¼Œç®€åŒ–æµåŠ¨æ€§ç®¡ç†ï¼Œä»¥åŠé¿å…å–æ•´å‡ºç°é—®é¢˜ï¼Œ`V3` ä½¿ç”¨äº†ä¸‹é¢è¿™äº›æ–°çš„æ ‡è¯†ï¼š

$$L = \sqrt{xy}$$

$$\sqrt{P} = \sqrt{\frac{y}{x}}$$

$L$ è¢«ç§°ä½œ *æµåŠ¨æ€§æ•°é‡*ã€‚æ± å­ä¸­çš„æµåŠ¨æ€§æ˜¯ä¸¤ç§ token èµ„äº§æ•°é‡çš„ç»„åˆã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒæŒ‰ç…§å…¬å¼ï¼Œä¸¤ç§ä»£å¸æ•°é‡ä¹˜ç§¯ä¸º $k$ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ $\sqrt{xy}$ æ¥è¡¡é‡æ± å­æµåŠ¨æ€§ã€‚$L$ å®é™…ä¸Šæ˜¯ $x$ å’Œ $y$ çš„å‡ ä½•å¹³å‡æ•°ã€‚

$y/x$ æ˜¯ token0 ç›¸å¯¹äº token1 çš„ä»·æ ¼ã€‚ç”±äºæ± å­é‡Œä¸¤ç§ä»£å¸çš„ä»·æ ¼äº’ä¸ºå€’æ•°ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—ä¸­ä»…ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª( Uniswap V3ä½¿ç”¨çš„æ˜¯ $y/x$)ã€‚token1 ç›¸å¯¹äº token0 çš„ä»·æ ¼å³ä¸º $\frac{1}{y/x}=\frac{x}{y}$ã€‚ç±»ä¼¼åœ°ï¼Œ $\frac{1}{\sqrt{P}} = \frac{1}{\sqrt{y/x}} = \sqrt{\frac{x}{y}}$.

æˆ‘ä»¬ä½¿ç”¨ $\sqrt{P}$ è€Œä¸æ˜¯ $P$ æœ‰ä¸¤ä¸ªåŸå› ï¼š

1. å¹³æ–¹æ ¹è®¡ç®—å¹¶ä¸ç²¾ç¡®å¹¶ä¸”ä¼šå¼•å…¥å–æ•´çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæ›´ç®€å•çš„æ–¹æ³•æ˜¯æˆ‘ä»¬å¹²è„†å°±åœ¨åˆçº¦ä¸­å­˜å¹³æ–¹æ ¹çš„ç»“æœï¼Œè€Œä¸æ˜¯åœ¨åˆçº¦ä¸­è®¡ç®—å®ƒã€‚ï¼ˆåˆçº¦ä¸­å¹¶ä¸å­˜å‚¨ $x$ å’Œ $y$ ï¼‰
2. $\sqrt{P}$ ä¸ $L$ ä¹‹é—´æœ‰ä¸€ä¸ªæœ‰è¶£çš„å…³ç³»ï¼š$L$ ä¹Ÿè¡¨ç¤ºäº†è¾“å‡ºæ•°é‡çš„å˜åŒ–ä¸ $\sqrt{P}$ çš„å˜åŒ–ä¹‹é—´çš„å…³ç³»ï¼š

    $L = \frac{\Delta y}{\Delta\sqrt{P}}$

> è¯æ˜:
$L = \frac{\Delta y}{\Delta\sqrt{P}}$

$$\sqrt{xy} = \frac{y_1 - y_0}{\sqrt{P_1} - \sqrt{P_0}}$$

$$\sqrt{xy} (\sqrt{P_1} - \sqrt{P_0}) = y_1 - y_0$$

$$\sqrt{xy} (\sqrt{\frac{y_1}{x_1}} - \sqrt{\frac{y_0}{x_0}}) = y_1 - y_0$$

$$\sqrt{y_1^2} - \sqrt{y_0^2} = y_1 - y_0$$ 

$$y_1 - y_0 = y_1 - y_0$$

ï¼ˆè¯‘è€…æ³¨ï¼šç¬¬å››æ­¥åˆ°ç¬¬äº”æ­¥ï¼Œ$\sqrt{xy} = \sqrt{x_0y_0} = \sqrt{x_1y_1}$ ï¼‰

## ä»·æ ¼

åŒæ ·ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è®¡ç®—å‡†ç¡®çš„ä»·æ ¼â€”â€”æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¡ç®—è·å¾—çš„ `token` æ•°é‡ã€‚å¹¶ä¸”ï¼Œç”±äºæˆ‘ä»¬åœ¨åˆçº¦ä¸­å¹¶ä¸å­˜å‚¨ $x$ å’Œ $y$ï¼Œæˆ‘ä»¬å°†ä»…é€šè¿‡ $L$ å’Œ $\sqrt{P}$ è¿›è¡Œè®¡ç®—ã€‚

æ ¹æ®ä¸Šæ–‡ä¸­çš„å…¬å¼ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ° $\Delta y$ï¼š


$$\Delta y = \Delta \sqrt{P} L$$

> è§ä¸Šè¿°è¯æ˜ä¸­çš„ç¬¬ä¸‰æ­¥ã€‚

æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼ŒåŒæ–¹çš„ä»·æ ¼äº’ä¸ºå€’æ•°ã€‚å› æ­¤ï¼Œ$\Delta x$ çš„å…¬å¼ä¸ºï¼š


$$\Delta x = \Delta \frac{1}{\sqrt{P}} L$$

$L$ å’Œ $\sqrt{P}$ è®©æˆ‘ä»¬ä¸å†éœ€è¦å­˜å‚¨å’Œæ›´æ–°æ± å­èµ„äº§æ•°é‡ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬ä¹Ÿå¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°è®¡ç®— $\sqrt{P}$ å› ä¸ºæˆ‘ä»¬ä»ä¸Šè¿°å…¬å¼å¯ä»¥å¾—åˆ° $\Delta \sqrt{P}$ã€‚


## Ticks

æ­£å¦‚æˆ‘ä»¬å‰é¢è¯´åˆ°çš„ï¼Œ`V2` ä¸­çš„æ— ç©·ä»·æ ¼åŒºé—´åœ¨ `V3` ä¸­è¢«åˆ†æˆäº†æ›´å°çš„ä»·æ ¼åŒºé—´ï¼Œæ¯ä¸ªåŒºé—´éƒ½ç”±ä¸Šä¸‹ç•Œç«¯ç‚¹è¿›è¡Œé™åˆ¶ã€‚ä¸ºäº†è¿›è¡Œè¿™äº›è¾¹ç•Œçš„åè°ƒï¼Œ`V3` å¼•å…¥äº† *`ticks`*ã€‚


![Price ranges and ticks](../images/milestone_0/ticks_and_ranges.png)

åœ¨ `V3`ï¼Œæ•´ä¸ªä»·æ ¼åŒºé—´ç”±ç¦»æ•£çš„ã€å‡åŒ€åˆ†å¸ƒçš„ `ticks` è¿›è¡Œæ ‡å®šã€‚æ¯ä¸ª `tick` æœ‰ä¸€ä¸ª `index` å’Œå¯¹åº”çš„ä»·æ ¼ï¼š

$$p(i) = 1.0001^i$$

$p(i)$ å³ä¸º tick $i$ çš„ä»·æ ¼. ä½¿ç”¨ 1.0001 çš„å¹‚æ¬¡ä½œä¸ºæ ‡å®šæœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ€§è´¨ï¼šä¸¤ä¸ªç›¸é‚» tick ä¹‹é—´çš„å·®è·ä¸º 0.01% æˆ–è€…*ä¸€ä¸ªåŸºç‚¹ã€‚*

> åŸºç‚¹ (1% çš„ç™¾åˆ†ä¹‹ä¸€ï¼Œæˆ–è€… 0.01%ï¼Œæˆ–è€… 0.0001)æ˜¯åœ¨é‡‘èä¸­ç”¨æ¥è¡¡é‡ç™¾åˆ†æ¯”çš„ä¸€ä¸ªå•ä½ã€‚ä½ å¯èƒ½åœ¨å¤®è¡Œå®£å¸ƒå¯¹äºåˆ©ç‡çš„è°ƒæ•´ä¸­å¬è¿‡åŸºç‚¹è¿™ä¸ªåè¯ã€‚

æ­£å¦‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„ï¼Œ`UniswapV3` å­˜å‚¨çš„æ˜¯ $\sqrt{P}$ è€Œä¸æ˜¯ $P$ã€‚æ‰€ä»¥è¿™ä¸ªå…¬å¼å®é™…ä¸Šæ˜¯ï¼š


$$\sqrt{p(i)} = \sqrt{1.0001}^i = 1.0001 ^{\frac{i}{2}}$$

æˆ‘ä»¬å¾—åˆ°çš„å€¼å¤§æ¦‚æ˜¯è¿™æ ·ï¼š$\sqrt{p(0)} = 1$, $\sqrt{p(1)} = \sqrt{1.0001} \approx 1.00005$, $\sqrt{p(-1)} \approx 0.99995$.

`Ticks` å¯ä»¥ä¸ºæ­£ä¹Ÿå¯ä»¥ä¸ºè´Ÿï¼Œå¹¶ä¸”æ˜¾ç„¶å®ƒä¸æ˜¯æ— ç©·çš„ã€‚
`V3` æŠŠ$\sqrt{P}$ å­˜å‚¨ä¸ºä¸€ä¸ª `Q64.96` ç±»å‹çš„å®šç‚¹æ•°ï¼Œä½¿ç”¨ 64 ä½ä½œä¸ºæ•´æ•°éƒ¨åˆ†ï¼Œä½¿ç”¨ 96 ä½ä½œä¸ºå°æ•°éƒ¨åˆ†ã€‚å› æ­¤ï¼Œä»·æ ¼çš„å–å€¼èŒƒå›´æ˜¯ $[2^{-128}, 2^{128}]$ï¼Œticks çš„å–å€¼èŒƒå›´æ˜¯ï¼š


$$[log_{1.0001}2^{-128}, log_{1.0001}{2^{128}}] = [-887272, 887272]$$

> å¦‚æœå¸Œæœ›å¯¹äº Uniswap V3 çš„æ•°å­¦åŸç†æœ‰æ›´æ·±çš„ç†è§£ï¼Œæ¨è[è¿™ç¯‡æŠ€æœ¯æ–‡ç« ](https://atiselsts.github.io/pdfs/uniswap-v3-liquidity-math.pdf)ï¼Œä½œè€…ä¸º [Atis Elsts](https://twitter.com/atiselsts)

